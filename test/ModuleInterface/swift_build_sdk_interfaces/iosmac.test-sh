RUN: %swift_build_sdk_interfaces -sdk %S/Inputs/iosmac-sdk/MacOSX.sdk/ -Fsystem-iosmac SECRET_SEARCH_PATH -v -n -o %t/output > %t.txt
RUN: %FileCheck %s < %t.txt
RUN: %FileCheck -check-prefix NEGATIVE %s < %t.txt

CHECK-DAG: PATH((MacOSX.sdk/System/Library/Frameworks/FMWK.framework/Modules/FMWK.swiftmodule/x86_64.swiftinterface)) -o PATH((.+/output/FMWK.swiftmodule/x86_64-apple-macos.swiftmodule))
CHECK-DAG: -Fsystem SECRET_SEARCH_PATH -Fsystem PATH((.+MacOSX.sdk/System/iOSSupport/System/Library/Frameworks)) PATH((.+MacOSX.sdk/System/iOSSupport/System/Library/Frameworks/FMWK.framework/Modules/FMWK.swiftmodule/x86_64.swiftinterface)) -o PATH((.+/output/FMWK.swiftmodule/x86_64-apple-ios-macabi.swiftmodule))
CHECK-DAG: PATH((MacOSX.sdk/usr/lib/swift/Foo.swiftmodule/x86_64.swiftinterface)) -o PATH((.+output/Foo.swiftmodule/x86_64-apple-macos.swiftmodule))
CHECK-DAG: -Fsystem SECRET_SEARCH_PATH -Fsystem {{.+}}MacOSX.sdk/System/iOSSupport/System/Library/Frameworks PATH((.+MacOSX.sdk/System/iOSSupport/usr/lib/swift/Foo.swiftmodule/x86_64.swiftinterface)) -o PATH((.+output/Foo.swiftmodule/x86_64-apple-ios-macabi.swiftmodule))
CHECK-DAG: PATH((MacOSX.sdk/System/Library/Frameworks/Zippered.framework/Modules/Zippered.swiftmodule/x86_64.swiftinterface)) -o PATH((.+/output/Zippered.swiftmodule/x86_64-apple-macos.swiftmodule))
CHECK-DAG: PATH((MacOSX.sdk/System/Library/Frameworks/Zippered.framework/Modules/Zippered.swiftmodule/x86_64-apple-macos.swiftinterface)) -o PATH((.+/output/Zippered.swiftmodule/x86_64-apple-macos.swiftmodule))
CHECK-DAG: -Fsystem SECRET_SEARCH_PATH -Fsystem PATH((.+MacOSX.sdk/System/iOSSupport/System/Library/Frameworks)) PATH((.+MacOSX.sdk/System/Library/Frameworks/Zippered.framework/Modules/Zippered.swiftmodule/x86_64-apple-ios-macabi.swiftinterface)) -o PATH((.+/output/Zippered.swiftmodule/x86_64-apple-ios-macabi.swiftmodule))

NEGATIVE-NOT: iOSSupport{{.+}}{{macos|x86_64}}.swiftmodule
NEGATIVE-NOT: SECRET_SEARCH_PATH{{.+}}{{macos|x86_64}}.swiftmodule
